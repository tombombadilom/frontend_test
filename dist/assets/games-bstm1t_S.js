import{M as ue,e as ie,r as t,j as e,m as pe,O as f,a2 as W,B as i,_ as de,L as ee,a3 as je,a4 as ge,a5 as fe,a6 as ve,a7 as Ne,a8 as be,a9 as ye,f as se}from"./index-A8xx-xxW.js";import{T as we,a as Ce,b as B,c as L,d as Se,e as S}from"./table-CsEzsDcl.js";import{P as re,a as ae,b as ne,F as Te,A as O,c as Pe}from"./popover-Cv9lAuA-.js";import{C as le}from"./checkbox-0GfaeNTR.js";import{T as Ie}from"./textarea-BaE4DFI9.js";import{u as Re,F as Fe,a as x,b as h,c as u,d as p,h as j,e as v,s as Ae,o as ce,f as te,i as Z,j as X,g}from"./form-NQCUH1ql.js";import{s as N}from"./toast-Cu_8kZFb.js";import{P as Y}from"./plus-B1589Br_.js";import{C as Ee,S as z,a as U,b as M,c as $,d}from"./select-pnobd5xa.js";import{T as Le}from"./trash-2-IQX5vnBl.js";import{E as Ge}from"./ellipsis-DGixAxWM.js";import"./index-DNZbadIk.js";import"./check-De8WsGE6.js";const _e=ce({title:g().min(3,"Title must be at least 3 characters").max(100,"Title cannot exceed 100 characters"),description:g().min(10,"Description must be at least 10 characters").max(2e3,"Description cannot exceed 2000 characters"),price:ce({amount:Z.number().min(.01,"Price must be greater than 0").max(999.99,"Price cannot exceed 999.99"),currency:g().min(1,"Currency is required").max(10,"Currency cannot exceed 10 characters"),discount:Z.number().min(0,"Discount cannot be negative").max(100,"Discount cannot exceed 100%").optional()}),releaseDate:g().min(1,"Release date is required"),developer:g().min(1,"Developer is required").max(100,"Developer cannot exceed 100 characters"),publisher:g().min(1,"Publisher is required").max(100,"Publisher cannot exceed 100 characters"),genres:X(g()).min(1,"At least one genre is required"),platforms:X(g()).min(1,"At least one platform is required"),coverImage:g().min(1,"Cover image is required"),screenshots:X(g()).min(1,"At least one screenshot is required"),rating:Z.number().min(0,"Rating cannot be negative").max(5,"Rating cannot exceed 5"),isFeatured:te().optional(),isNewRelease:te().optional()});function oe({editMode:m=!1}){const T=ue(),{id:P}=ie(),[a,G]=t.useState(null),[A,_]=t.useState(m),[I,R]=t.useState([]),[b,y]=t.useState([]),[w,k]=t.useState(""),[F,H]=t.useState(""),[o,C]=t.useState([]),c=Re({resolver:Ae(_e),defaultValues:{title:(a==null?void 0:a.title)||"",description:(a==null?void 0:a.description)||"",price:{amount:(a==null?void 0:a.price.amount)||0,currency:(a==null?void 0:a.price.currency)||"EUR",discount:(a==null?void 0:a.price.discount)||0},releaseDate:(a==null?void 0:a.releaseDate)||"",developer:(a==null?void 0:a.developer)||"",publisher:(a==null?void 0:a.publisher)||"",genres:(a==null?void 0:a.genres)||[],platforms:(a==null?void 0:a.platforms)||[],coverImage:(a==null?void 0:a.coverImage)||"",screenshots:(a==null?void 0:a.screenshots)||[],rating:(a==null?void 0:a.rating)||0,isFeatured:(a==null?void 0:a.isFeatured)||!1,isNewRelease:(a==null?void 0:a.isNewRelease)||!1}});t.useEffect(()=>{(async()=>{if(m&&P)try{_(!0);const s=await de(()=>import("./games-Ckgb04l5.js"),[]);console.log("Loading game with ID:",P);const n=Number.parseInt(P,10);console.log("Parsed game ID:",n);const l=s.default.games.find(Q=>Q.id===n);console.log("Found game:",l),l?(G(l),R(l.genres),y(l.platforms),C(l.screenshots),c.reset({title:l.title,description:l.description,price:{amount:l.price.amount,currency:l.price.currency,discount:l.price.discount},releaseDate:l.releaseDate,developer:l.developer,publisher:l.publisher,genres:l.genres,platforms:l.platforms,coverImage:l.coverImage,screenshots:l.screenshots,rating:l.rating,isFeatured:l.isFeatured,isNewRelease:l.isNewRelease})):(console.error("Game not found with ID:",n),N.error("Jeu non trouvé"),T("/admin/games"))}catch(s){console.error("Erreur lors du chargement du jeu:",s),N.error("Erreur lors du chargement du jeu")}finally{_(!1)}})()},[m,P,c,T]);const E=()=>{if(w.trim()){if(I.some(r=>r.toLowerCase()===w.toLowerCase())){N.error("This genre already exists");return}if(w.length>50){N.error("Genre name is too long (max 50 characters)");return}R([...I,w]),k("")}},K=r=>{R(I.filter(s=>s!==r))},V=()=>{if(F.trim()){if(b.some(r=>r.toLowerCase()===F.toLowerCase())){N.error("This platform already exists");return}if(F.length>20){N.error("Platform name is too long (max 20 characters)");return}y([...b,F]),H("")}},J=r=>{y(b.filter(s=>s!==r))},D=async r=>{try{const s={id:(a==null?void 0:a.id)||Math.floor(Date.now()/1e3),gameId:(a==null?void 0:a.gameId)||Math.floor(Date.now()/1e3),title:r.title,description:r.description,price:r.price,releaseDate:r.releaseDate,developer:r.developer,publisher:r.publisher,genres:r.genres,platforms:r.platforms,coverImage:r.coverImage,screenshots:r.screenshots,rating:r.rating,isFeatured:r.isFeatured,isNewRelease:r.isNewRelease};console.log("Données du jeu à envoyer:",s),N.success(m?"Jeu mis à jour avec succès":"Jeu créé avec succès"),T("/admin/games")}catch(s){console.error("Erreur lors de la soumission:",s),N.error("Une erreur est survenue")}};return A?e.jsx("div",{className:"flex h-full items-center justify-center p-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs(pe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:m?"Modifier le Jeu":"Ajouter un Jeu"}),e.jsx("p",{className:"text-muted-foreground",children:m?"Modifiez les informations du Jeu":"Ajoutez un nouveau Jeu au catalogue"})]}),e.jsx(Fe,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(D),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"General information"}),e.jsx(x,{control:c.control,name:"title",render:({field:r})=>e.jsxs(h,{children:[e.jsx(u,{children:"Title"}),e.jsx(p,{children:e.jsx(f,{placeholder:"Enter game title",...r})}),e.jsx(j,{children:"The title of the game as it appears in the store."}),e.jsx(v,{})]})}),e.jsx(x,{control:c.control,name:"description",render:({field:r})=>e.jsxs(h,{children:[e.jsx(u,{children:"Description"}),e.jsx(p,{children:e.jsx(Ie,{placeholder:"Enter game description",className:"min-h-[100px]",...r})}),e.jsx(j,{children:"A detailed description of the game."}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsx(x,{control:c.control,name:"price.amount",render:({field:r})=>e.jsxs(h,{children:[e.jsx(u,{children:"Price"}),e.jsx(p,{children:e.jsx(f,{type:"number",step:"0.01",placeholder:"0.00",...r})}),e.jsx(j,{children:"The base price of the game."}),e.jsx(v,{})]})}),e.jsx(x,{control:c.control,name:"price.currency",render:({field:r})=>e.jsxs(h,{children:[e.jsx(u,{children:"Currency"}),e.jsx(p,{children:e.jsx(f,{placeholder:"EUR",...r})}),e.jsx(j,{children:"The currency of the game price."}),e.jsx(v,{})]})}),e.jsx(x,{control:c.control,name:"price.discount",render:({field:r})=>e.jsxs(h,{children:[e.jsx(u,{children:"Discount (%)"}),e.jsx(p,{children:e.jsx(f,{type:"number",step:"1",placeholder:"0",...r})}),e.jsx(j,{children:"The discount percentage (0-100)."}),e.jsx(v,{})]})})]}),e.jsx(x,{control:c.control,name:"releaseDate",render:({field:r})=>e.jsxs(h,{children:[e.jsx(u,{children:"Release Date"}),e.jsx(p,{children:e.jsx(f,{type:"date",...r})}),e.jsx(j,{children:"The release date of the game."}),e.jsx(v,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(x,{control:c.control,name:"developer",render:({field:r})=>e.jsxs(h,{children:[e.jsx(u,{children:"Developer"}),e.jsx(p,{children:e.jsx(f,{placeholder:"Enter developer name",...r})}),e.jsx(j,{children:"The developer of the game."}),e.jsx(v,{})]})}),e.jsx(x,{control:c.control,name:"publisher",render:({field:r})=>e.jsxs(h,{children:[e.jsx(u,{children:"Publisher"}),e.jsx(p,{children:e.jsx(f,{placeholder:"Enter publisher name",...r})}),e.jsx(j,{children:"The publisher of the game."}),e.jsx(v,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Genres"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(r=>e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-primary/10 px-3 py-1 text-sm",children:[e.jsx("span",{children:r}),e.jsxs("button",{type:"button",onClick:()=>K(r),className:"text-destructive hover:text-destructive/80",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs("span",{className:"sr-only",children:["Remove ",r]})]})]},r))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{placeholder:"Add a genre",value:w,onChange:r=>k(r.target.value),onKeyPress:r=>{r.key==="Enter"&&(r.preventDefault(),E())}}),e.jsxs(i,{type:"button",onClick:E,children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Add genre"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Platforms"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(r=>e.jsxs("div",{className:"flex items-center gap-1 rounded-full bg-primary/10 px-3 py-1 text-sm",children:[e.jsx("span",{children:r}),e.jsxs("button",{type:"button",onClick:()=>J(r),className:"text-destructive hover:text-destructive/80",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs("span",{className:"sr-only",children:["Remove ",r]})]})]},r))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{placeholder:"Add a platform",value:F,onChange:r=>H(r.target.value),onKeyPress:r=>{r.key==="Enter"&&(r.preventDefault(),V())}}),e.jsxs(i,{type:"button",onClick:V,children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Add platform"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Visibility"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{control:c.control,name:"isFeatured",render:({field:r})=>e.jsxs(h,{className:"flex flex-row items-center space-x-3 space-y-0",children:[e.jsx(p,{children:e.jsx(le,{checked:r.value,onCheckedChange:r.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(u,{children:"Featured"}),e.jsx(j,{children:"Show this game in the featured section."})]})]})}),e.jsx(x,{control:c.control,name:"isNewRelease",render:({field:r})=>e.jsxs(h,{className:"flex flex-row items-center space-x-3 space-y-0",children:[e.jsx(p,{children:e.jsx(le,{checked:r.value,onCheckedChange:r.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(u,{children:"New Release"}),e.jsx(j,{children:"Show this game in the new releases section."})]})]})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>T("/admin/games"),children:"Cancel"}),e.jsx(i,{type:"submit",disabled:c.formState.isSubmitting,children:c.formState.isSubmitting?m?"Updating...":"Creating...":m?"Update Jeu":"Create Jeu"})]})]})})]})}function Ze({isNew:m,isEdit:T}){const{id:P}=ie(),[a,G]=t.useState(""),[A,_]=t.useState([]),[I,R]=t.useState(!0),[b,y]=t.useState(!1),[w,k]=t.useState(""),[F,H]=t.useState("fr"),[o,C]=t.useState({platform:"",genre:"",priceRange:"",sortBy:"",isActive:void 0}),[c,E]=t.useState(!1);t.useEffect(()=>{(async()=>{try{R(!0);const n=await de(()=>import("./games-Ckgb04l5.js"),[]);_(n.default.games||[])}catch(n){console.error("Erreur lors du chargement des jeux:",n)}finally{R(!1)}})()},[]);const K=Array.from(new Set(A.flatMap(s=>s.platforms))),V=Array.from(new Set(A.flatMap(s=>s.genres))),J=[{label:"0€ - 10€",min:0,max:10},{label:"10€ - 30€",min:10,max:30},{label:"30€ - 60€",min:30,max:60},{label:"60€+",min:60,max:Number.POSITIVE_INFINITY}],r=[...A.filter(s=>{const n=s.title.toLowerCase().includes(a.toLowerCase())||s.description.toLowerCase().includes(a.toLowerCase())||s.genres.some(q=>q.toLowerCase().includes(a.toLowerCase()))||s.platforms.some(q=>q.toLowerCase().includes(a.toLowerCase())),l=!o.platform||s.platforms.includes(o.platform),Q=!o.genre||s.genres.includes(o.genre),me=!o.priceRange||J.find(q=>{const[xe,he]=o.priceRange.split("-").map(Number);return s.price.amount>=xe&&s.price.amount<=he});return n&&l&&Q&&me})].sort((s,n)=>{switch(o.sortBy){case"price-asc":return s.price.amount-n.price.amount;case"price-desc":return n.price.amount-s.price.amount;case"title-asc":return s.title.localeCompare(n.title);case"title-desc":return n.title.localeCompare(s.title);default:return 0}});return m?e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Créer un nouveau jeu"}),e.jsx(oe,{})]}):T&&P?e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Modifier le jeu"}),e.jsx(oe,{editMode:!0})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Jeux"}),e.jsxs(ee,{to:"/admin/games/new",className:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),"Ajouter un jeu"]})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[e.jsx("div",{className:"relative flex-1",children:e.jsxs(re,{open:b,onOpenChange:y,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full justify-start",onClick:()=>y(!b),children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:w||"Rechercher un jeu..."}),e.jsx(Ee,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ne,{className:"w-[300px] p-0",align:"start",children:e.jsxs(ge,{className:"bg-command border-command-border",children:[e.jsx(fe,{placeholder:"Rechercher un jeu...",value:a,onValueChange:G,className:"bg-command-input text-command-foreground"}),e.jsxs(ve,{className:"bg-command",children:[e.jsx(Ne,{children:"Aucun jeu trouvé"}),e.jsx(be,{heading:"Jeux",className:"text-command-foreground",children:r.slice(0,10).map(s=>e.jsx(ye,{value:s.title,onSelect:()=>{G(s.title),k(s.title),y(!1)},className:"bg-command-item hover:bg-command-item-hover data-[selected=true]:bg-command-item-selected data-[selected=true]:text-command-item-selected-foreground",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:s.coverImage||"/placeholder.svg",alt:s.title,className:"h-6 w-6 rounded object-cover"}),e.jsx("span",{children:s.title}),e.jsx("span",{className:"ml-auto text-xs text-muted-foreground",children:se(s.price)})]})},s.id))})]})]})})]})}),e.jsxs(re,{open:c,onOpenChange:E,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(i,{variant:"outline",className:"w-full md:w-auto",disabled:!0,children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Filtres",Object.values(o).some(s=>s!=="")&&e.jsx("span",{className:"ml-2 rounded-full bg-primary w-2 h-2"})]})}),e.jsx(ne,{className:"w-80",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Plateformes"}),e.jsxs(z,{value:o.platform,onValueChange:s=>C(n=>({...n,platform:s})),children:[e.jsx(U,{className:"bg-command border-command-border",children:e.jsx(M,{placeholder:"Toutes les plateformes"})}),e.jsxs($,{className:"bg-command border-command-border",children:[e.jsx(d,{value:"",className:"bg-command-item hover:bg-command-item-hover",children:"Toutes les plateformes"}),K.map(s=>e.jsx(d,{value:s,className:"bg-command-item hover:bg-command-item-hover data-[selected=true]:bg-command-item-selected data-[selected=true]:text-command-item-selected-foreground",children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Genres"}),e.jsxs(z,{value:o.genre,onValueChange:s=>C(n=>({...n,genre:s})),children:[e.jsx(U,{children:e.jsx(M,{placeholder:"Tous les genres"})}),e.jsxs($,{children:[e.jsx(d,{value:"",children:"Tous les genres"}),V.map(s=>e.jsx(d,{value:s,children:s},s))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Prix"}),e.jsxs(z,{value:o.priceRange,onValueChange:s=>C(n=>({...n,priceRange:s})),children:[e.jsx(U,{children:e.jsx(M,{placeholder:"Tous les prix"})}),e.jsxs($,{children:[e.jsx(d,{value:"",children:"Tous les prix"}),J.map(s=>e.jsx(d,{value:`${s.min}-${s.max}`,children:s.label},s.label))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Trier par"}),e.jsxs(z,{value:o.sortBy,onValueChange:s=>C(n=>({...n,sortBy:s})),children:[e.jsx(U,{children:e.jsx(M,{placeholder:"Trier par..."})}),e.jsxs($,{children:[e.jsx(d,{value:"",children:"Par défaut"}),e.jsx(d,{value:"price-asc",children:"Prix croissant"}),e.jsx(d,{value:"price-desc",children:"Prix décroissant"}),e.jsx(d,{value:"title-asc",children:"Titre A-Z"}),e.jsx(d,{value:"title-desc",children:"Titre Z-A"})]})]})]}),e.jsx(i,{variant:"outline",onClick:()=>{C({platform:"",genre:"",priceRange:"",sortBy:"",isActive:void 0}),E(!1)},children:"Réinitialiser les filtres"})]})})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(we,{children:[e.jsx(Ce,{children:e.jsxs(B,{children:[e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-1",children:["Jeu",e.jsx(O,{className:"h-4 w-4"})]})}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-1",children:["Prix",e.jsx(O,{className:"h-4 w-4"})]})}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-1",children:["Catégories",e.jsx(O,{className:"h-4 w-4"})]})}),e.jsx(L,{children:e.jsxs("div",{className:"flex items-center gap-1",children:["Plateformes",e.jsx(O,{className:"h-4 w-4"})]})}),e.jsx(L,{className:"text-right",children:"Actions"})]})}),e.jsx(Se,{children:I?e.jsx(B,{children:e.jsx(S,{colSpan:5,className:"text-center py-8",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})})})}):r.length===0?e.jsx(B,{children:e.jsx(S,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Aucun jeu trouvé"})}):r.map(s=>e.jsxs(B,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:s.coverImage||"/placeholder.svg",alt:s.title,className:"h-10 w-10 rounded object-cover"}),e.jsx("span",{className:"font-medium",children:s.title})]})}),e.jsx(S,{children:se(s.price)}),e.jsx(S,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.genres.map(n=>e.jsx("span",{className:"rounded-sm bg-muted px-1.5 py-0.5 text-xs",children:n},n))})}),e.jsx(S,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.platforms.map(n=>e.jsx("span",{className:"rounded-sm bg-muted px-1.5 py-0.5 text-xs",children:n},n))})}),e.jsx(S,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(i,{variant:"ghost",size:"icon",asChild:!0,children:e.jsxs(ee,{to:`/admin/games/edit/${s.id}`,children:[e.jsx(Pe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Modifier"})]})}),e.jsxs(i,{variant:"ghost",size:"icon",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Supprimer"})]}),e.jsxs(i,{variant:"ghost",size:"icon",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Plus"})]})]})})]},s.id))})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",r.length," jeux"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",disabled:!0,children:"Précédent"}),e.jsx(i,{variant:"outline",size:"sm",children:"Suivant"})]})]})]})}export{Ze as default};
