import{M as U,e as R,r as t,j as e,m as H,O as Q,B as l,_ as k,L as T,a3 as Z,a4 as q,a5 as G,a6 as $,a7 as J,a8 as K,a9 as W}from"./index-A8xx-xxW.js";import{T as X,a as Y,b as N,c as b,d as ee,e as h}from"./table-CsEzsDcl.js";import{P as E,a as I,b as P,F as se,A as re,c as ae}from"./popover-Cv9lAuA-.js";import{C as te,S as ne,a as ie,b as oe,c as ce,d as w}from"./select-pnobd5xa.js";import{T as le}from"./textarea-BaE4DFI9.js";import{u as de,s as me,F as ue,a as A,b as _,c as D,d as z,h as O,e as B,z as S}from"./form-NQCUH1ql.js";import{s as y}from"./toast-Cu_8kZFb.js";import{P as he}from"./plus-B1589Br_.js";import{T as xe}from"./trash-2-IQX5vnBl.js";import{E as je}from"./ellipsis-DGixAxWM.js";import"./index-DNZbadIk.js";import"./check-De8WsGE6.js";const pe=S.object({name:S.string().min(3,"Le nom doit contenir au moins 3 caractères").max(100,"Le nom ne peut pas dépasser 100 caractères"),description:S.string().min(10,"La description doit contenir au moins 10 caractères").max(2e3,"La description ne peut pas dépasser 2000 caractères")});function V({editMode:n=!1}){const m=U(),{id:u}=R(),[i,p]=t.useState(null),[C,g]=t.useState(n),o=de({resolver:me(pe),defaultValues:{name:"",description:""}});t.useEffect(()=>{(async()=>{if(n&&u)try{g(!0);const a=await k(()=>import("./objects-categories-DQIGr8qy.js"),[]);console.log("Loading category with ID:",u);const x=Number.parseInt(u,10);console.log("Parsed category ID:",x);const d=a.default.categories.find(j=>j.id===x);console.log("Found category:",d),d?(p(d),o.reset({name:d.name,description:d.description})):(console.error("Category not found with ID:",x),y.error("Catégorie non trouvée"),m("/admin/object-categories"))}catch(a){console.error("Erreur lors du chargement de la catégorie:",a),y.error("Erreur lors du chargement de la catégorie")}finally{g(!1)}})()},[n,u,o,m]);const f=async c=>{try{const a={id:(i==null?void 0:i.id)||Math.floor(Date.now()/1e3),name:c.name,description:c.description,subcategories:(i==null?void 0:i.subcategories)||[]};console.log("Données de la catégorie à envoyer:",a),y.success(n?"Catégorie mise à jour avec succès":"Catégorie créée avec succès"),m("/admin/object-categories")}catch(a){console.error("Erreur lors de la soumission:",a),y.error("Une erreur est survenue")}};return C?e.jsx("div",{className:"flex h-full items-center justify-center p-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:n?"Modifier la catégorie":"Ajouter une catégorie"}),e.jsx("p",{className:"text-muted-foreground",children:n?"Modifiez les informations de la catégorie":"Ajoutez une nouvelle catégorie"})]}),e.jsx(ue,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(f),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(A,{control:o.control,name:"name",render:({field:c})=>e.jsxs(_,{children:[e.jsx(D,{children:"Nom"}),e.jsx(z,{children:e.jsx(Q,{placeholder:"Entrez le nom de la catégorie",...c})}),e.jsx(O,{children:"Le nom de la catégorie tel qu'il apparaîtra dans le catalogue."}),e.jsx(B,{})]})}),e.jsx(A,{control:o.control,name:"description",render:({field:c})=>e.jsxs(_,{children:[e.jsx(D,{children:"Description"}),e.jsx(z,{children:e.jsx(le,{placeholder:"Entrez la description de la catégorie",className:"min-h-[100px]",...c})}),e.jsx(O,{children:"Une description détaillée de la catégorie."}),e.jsx(B,{})]})})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>m("/admin/object-categories"),children:"Annuler"}),e.jsx(l,{type:"submit",disabled:o.formState.isSubmitting,children:o.formState.isSubmitting?n?"Mise à jour...":"Création...":n?"Mettre à jour":"Créer"})]})]})})]})}function Ie({isNew:n,isEdit:m}){const{id:u}=R(),[i,p]=t.useState(""),[C,g]=t.useState([]),[o,f]=t.useState(!0),[c,a]=t.useState(!1),[x,d]=t.useState(""),[j,L]=t.useState({sortBy:""}),[M,F]=t.useState(!1);t.useEffect(()=>{(async()=>{try{f(!0);const r=await k(()=>import("./objects-categories-DQIGr8qy.js"),[]);g(r.default.categories||[])}catch(r){console.error("Erreur lors du chargement des catégories:",r)}finally{f(!1)}})()},[]);const v=[...C.filter(s=>s.name.toLowerCase().includes(i.toLowerCase())||s.description.toLowerCase().includes(i.toLowerCase()))].sort((s,r)=>{switch(j.sortBy){case"name-asc":return s.name.localeCompare(r.name);case"name-desc":return r.name.localeCompare(s.name);default:return 0}});return n?e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Créer une nouvelle catégorie d'objets"}),e.jsx(V,{})]}):m&&u?e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Modifier la catégorie d'objets"}),e.jsx(V,{editMode:!0})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Catégories d'objets"}),e.jsxs(T,{to:"/admin/object-categories/new",className:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Ajouter une catégorie"]})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[e.jsx("div",{className:"relative flex-1",children:e.jsxs(E,{open:c,onOpenChange:a,children:[e.jsx(I,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"w-full justify-start",onClick:()=>a(!c),children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:x||"Rechercher une catégorie..."}),e.jsx(te,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(P,{className:"w-[300px] p-0",align:"start",children:e.jsxs(q,{children:[e.jsx(G,{placeholder:"Rechercher une catégorie...",value:i,onValueChange:p}),e.jsxs($,{children:[e.jsx(J,{children:"Aucune catégorie trouvée"}),e.jsx(K,{heading:"Catégories",children:v.slice(0,10).map(s=>e.jsx(W,{value:s.name,onSelect:()=>{p(s.name),d(s.name),a(!1)},children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:s.name})})},s.id))})]})]})})]})}),e.jsxs(E,{open:M,onOpenChange:F,children:[e.jsx(I,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"w-full md:w-auto",disabled:!0,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Filtres",Object.values(j).some(s=>s!=="")&&e.jsx("span",{className:"ml-2 rounded-full bg-primary w-2 h-2"})]})}),e.jsx(P,{className:"w-80",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Trier par"}),e.jsxs(ne,{value:j.sortBy,onValueChange:s=>L(r=>({...r,sortBy:s})),children:[e.jsx(ie,{children:e.jsx(oe,{placeholder:"Trier par..."})}),e.jsxs(ce,{children:[e.jsx(w,{value:"",children:"Par défaut"}),e.jsx(w,{value:"name-asc",children:"Nom A-Z"}),e.jsx(w,{value:"name-desc",children:"Nom Z-A"})]})]})]}),e.jsx(l,{variant:"outline",onClick:()=>{L({sortBy:""}),F(!1)},children:"Réinitialiser les filtres"})]})})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center gap-1",children:["Nom",e.jsx(re,{className:"h-4 w-4"})]})}),e.jsx(b,{children:"Description"}),e.jsx(b,{children:"Sous-catégories"}),e.jsx(b,{className:"text-right",children:"Actions"})]})}),e.jsx(ee,{children:o?e.jsx(N,{children:e.jsx(h,{colSpan:4,className:"text-center py-8",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})})})}):v.length===0?e.jsx(N,{children:e.jsx(h,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"Aucune catégorie trouvée"})}):v.map(s=>{var r;return e.jsxs(N,{children:[e.jsx(h,{children:e.jsx("span",{className:"font-medium",children:s.name})}),e.jsx(h,{children:s.description}),e.jsx(h,{children:((r=s.subcategories)==null?void 0:r.length)||0}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{variant:"ghost",size:"icon",asChild:!0,children:e.jsxs(T,{to:`/admin/object-categories/edit/${s.id}`,children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Modifier"})]})}),e.jsxs(l,{variant:"ghost",size:"icon",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Supprimer"})]}),e.jsxs(l,{variant:"ghost",size:"icon",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Plus"})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",v.length," catégories"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",disabled:!0,children:"Précédent"}),e.jsx(l,{variant:"outline",size:"sm",children:"Suivant"})]})]})]})}export{Ie as default};
