import{r as u,p as V,q as W,u as k,a as P,j as e,L as D,m as w,f as O,B as h,H as T,b as S,S as L,ak as E}from"./index-A8xx-xxW.js";import{f as H,e as F}from"./catalog-layout-CapVVbF_.js";import{u as U}from"./use-objects-Cfbv402g.js";import{s as x}from"./toast-Cu_8kZFb.js";import{C as b,a as M,b as G}from"./card-DVQQUcVi.js";import{m as g,T as $,S as q}from"./motion-BMEn2pEQ.js";import{C as B,a as z,P as K,b as Y,c as I,d as X,e as J}from"./pagination-Cxq5DVxe.js";import{u as Q}from"./use-infinite-scroll-DTpYy80u.js";import{C as Z}from"./select-pnobd5xa.js";import"./skeleton-D6u_i3Qj.js";import"./objects-CxMhMVRW.js";import"./ellipsis-DGixAxWM.js";import"./index-DNZbadIk.js";import"./check-De8WsGE6.js";const ee=(s,t)=>t?s.filter(i=>i.name.toLowerCase().includes(t.toLowerCase())):s,se=(s,t)=>t.length>0?s.filter(i=>t.includes(i.gameId.toString())):s,te=(s,t)=>t.length>0?s.filter(i=>t.includes(i.category.toString())):s,ie=(s,t)=>t.length>0?s.filter(i=>t.includes(i.rarity)):s,ae=(s,t)=>t.length>0?s.filter(i=>i.tags.some(a=>t.includes(a.toLowerCase()))):s,re=(s,t,i)=>s.filter(a=>{const r=a.price.amount*(1-(a.price.discount||0)/100);return r>=t&&r<=i}),ne=s=>s.filter(t=>(t.price.discount||0)>0),le=s=>{const t=new Date;return t.setMonth(t.getMonth()-1),s.filter(i=>{var r;return(r=i.availability)!=null&&r.startDate?new Date(i.availability.startDate)>=t:!1})},oe=(s,t)=>{const i=[...s];return i.sort((a,r)=>{var c,m;switch(t){case"price-asc":return a.price.amount*(1-(a.price.discount||0)/100)-r.price.amount*(1-(r.price.discount||0)/100);case"price-desc":return r.price.amount*(1-(r.price.discount||0)/100)-a.price.amount*(1-(a.price.discount||0)/100);case"name-asc":return a.name.localeCompare(r.name);case"name-desc":return r.name.localeCompare(a.name);case"newest":return!((c=a.availability)!=null&&c.startDate)||!((m=r.availability)!=null&&m.startDate)?0:new Date(r.availability.startDate).getTime()-new Date(a.availability.startDate).getTime();default:return 0}}),i};function ce(s){const t=H(),i=u.useMemo(()=>{let a=[...s];return a=ee(a,t.search),a=se(a,t.games),a=te(a,t.categories),a=ie(a,t.rarities),a=ae(a,t.platforms),a=re(a,t.priceRange[0],t.priceRange[1]),t.onlyDiscounted&&(a=ne(a)),t.onlyNewReleases&&(a=le(a)),oe(a,t.sortBy)},[s,t.search,t.games,t.categories,t.rarities,t.platforms,t.priceRange,t.onlyDiscounted,t.onlyNewReleases,t.sortBy]);return{filters:t,filteredObjects:i}}const R=V()(W(s=>({recentlyViewed:[],addToRecentlyViewed:t=>s(i=>{const a={id:t.id,name:t.name,preview:t.preview,timestamp:Date.now()},r=i.recentlyViewed.filter(c=>c.id!==t.id).slice(0,9);return{recentlyViewed:[a,...r]}}),clearRecentlyViewed:()=>s({recentlyViewed:[]})}),{name:"object-history-storage",version:1,migrate:(s,t)=>t===0?{recentlyViewed:[]}:s}));function de({object:s}){var f;const[t,i]=u.useState(!0),[a,r]=u.useState(!1),{addItem:c}=k(),{addItem:m,removeItem:v,isInWishlist:p}=P(),{addToRecentlyViewed:N}=R(),n=o=>{var l;o.preventDefault(),o.stopPropagation(),c({id:s.id.toString(),name:s.name,price:s.price,image:((l=s.preview)==null?void 0:l.imageUrl)||"/placeholder.svg",quantity:1}),x.success("Added to cart")},y=o=>{o.preventDefault(),o.stopPropagation(),p(s.id.toString())?(v(s.id.toString()),x.success("Removed from wishlist")):(m(s),x.success("Added to wishlist"))},j=()=>{N(s)};return e.jsx(D,{to:`/objects/${s.id}`,onClick:j,children:e.jsx(w.div,{...g.cards.container,children:e.jsxs($,{className:"group relative w-full",rotationFactor:g.tilt.rotationFactor,springOptions:g.tilt.springOptions,children:[e.jsx(q,{className:"z-10 from-game-primary/40 via-game-primary/20 to-transparent blur-3xl",size:400,springOptions:{stiffness:20,damping:10}}),e.jsxs(b,{className:"h-full overflow-hidden transition-all hover:shadow-lg border-none",children:[e.jsx(w.div,{className:"relative aspect-[16/9] overflow-hidden",whileHover:g.cards.image.hover,transition:g.cards.image.transition,children:e.jsx("img",{src:((f=s.preview)==null?void 0:f.imageUrl)||"/placeholder.svg",alt:s.name,className:"h-full w-full object-cover",onError:()=>r(!0),onLoad:()=>i(!1)})}),e.jsxs(M,{className:"p-4",children:[e.jsx("h3",{className:"line-clamp-1 text-lg font-semibold group-hover:text-primary",children:s.name}),e.jsx("p",{className:"mt-2 line-clamp-2 text-sm text-muted-foreground",children:s.description})]}),e.jsx(G,{className:"p-4 pt-0",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{className:"text-lg font-bold",children:O(s.price)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w.div,{className:"cursor-pointer",whileHover:g.buttons.hover,whileTap:g.buttons.tap,children:e.jsx(h,{size:"icon",variant:"secondary",className:"h-8 w-8 rounded-full opacity-90 hover:opacity-100",onClick:y,children:e.jsx(T,{className:S("h-4 w-4",p(s.id.toString())&&"fill-current text-red-500")})})}),e.jsx(w.div,{className:"cursor-pointer",whileHover:g.buttons.hover,whileTap:g.buttons.tap,children:e.jsx(h,{size:"icon",variant:"secondary",className:"h-8 w-8 rounded-full opacity-90 hover:opacity-100",onClick:n,children:e.jsx(L,{className:"h-4 w-4"})})})]})]})})]})]})})})}function _({objects:s}){return e.jsx("div",{className:"container mx-auto space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e.jsx(E,{mode:"popLayout",children:s.map((t,i)=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,delay:i%4*.1},children:e.jsx(de,{object:t})},t.id))})})})}function me({object:s,onPrevious:t,onNext:i}){var l;const[a,r]=u.useState(!0),[c,m]=u.useState(!1),{addItem:v}=k(),{addItem:p,removeItem:N,isInWishlist:n}=P(),{addToRecentlyViewed:y}=R(),j=d=>{var A;d.preventDefault(),d.stopPropagation(),v({id:s.id.toString(),name:s.name,price:s.price,image:((A=s.preview)==null?void 0:A.imageUrl)||"/placeholder.svg",quantity:1}),x.success("Added to cart")},f=d=>{d.preventDefault(),d.stopPropagation(),n(s.id.toString())?(N(s.id.toString()),x.success("Removed from wishlist")):(p(s),x.success("Added to wishlist"))},o=()=>{y(s)};return e.jsx(D,{to:`/objects/${s.id}`,onClick:o,children:e.jsxs(b,{className:"group relative aspect-[16/9] overflow-hidden border-none",children:[e.jsx("img",{src:((l=s.preview)==null?void 0:l.imageUrl)||"/placeholder.svg",alt:s.name,className:"h-full w-full object-cover transition-transform duration-300 group-hover:scale-105",onError:()=>m(!0),onLoad:()=>r(!1)}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/50 to-transparent p-6 flex flex-col justify-end",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:s.name}),e.jsx("p",{className:"line-clamp-2 text-sm text-white/80 mb-4",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-lg font-bold text-white",children:O(s.price)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{size:"icon",variant:"secondary",className:"h-8 w-8",onClick:f,children:e.jsx(T,{className:S("h-5 w-5",n(s.id.toString())&&"fill-current text-red-500")})}),e.jsx(h,{size:"icon",variant:"secondary",className:"h-8 w-8",onClick:j,children:e.jsx(L,{className:"h-5 w-5"})})]})]})]}),e.jsxs("div",{className:"absolute inset-x-4 top-1/2 -translate-y-1/2 flex justify-between opacity-0 transition-opacity group-hover:opacity-100",children:[t&&e.jsx(h,{variant:"secondary",size:"icon",className:"h-10 w-10 rounded-full bg-black/50 hover:bg-black/70",onClick:d=>{d.preventDefault(),d.stopPropagation(),t()},children:e.jsx(B,{className:"h-6 w-6 text-white"})}),i&&e.jsx(h,{variant:"secondary",size:"icon",className:"h-10 w-10 rounded-full bg-black/50 hover:bg-black/70",onClick:d=>{d.preventDefault(),d.stopPropagation(),i()},children:e.jsx(z,{className:"h-6 w-6 text-white"})})]})]})})}function he({objects:s,onPrevious:t,onNext:i}){return e.jsx("div",{className:"relative group",children:e.jsx(E,{mode:"popLayout",children:e.jsx(w.div,{initial:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},transition:{duration:.3},children:e.jsx(me,{object:s[0],onPrevious:t,onNext:i})},s[0].id)})})}function ue({object:s}){var f;const[t,i]=u.useState(!0),[a,r]=u.useState(!1),{addItem:c}=k(),{addItem:m,removeItem:v,isInWishlist:p}=P(),{addToRecentlyViewed:N}=R(),n=o=>{var l;o.preventDefault(),o.stopPropagation(),c({id:s.id.toString(),name:s.name,price:s.price,image:((l=s.preview)==null?void 0:l.imageUrl)||"/placeholder.svg",quantity:1}),x.success("Added to cart")},y=o=>{o.preventDefault(),o.stopPropagation(),p(s.id.toString())?(v(s.id.toString()),x.success("Removed from wishlist")):(m(s),x.success("Added to wishlist"))},j=()=>{N(s)};return e.jsx(D,{to:`/objects/${s.id}`,onClick:j,className:"block h-full w-full py-2",children:e.jsxs(b,{className:"grid grid-cols-[60%_1fr] h-full w-full overflow-hidden border-none transition-all hover:bg-accent/5",children:[e.jsx("div",{className:"relative h-full",children:e.jsx("img",{src:((f=s.preview)==null?void 0:f.imageUrl)||"/placeholder.svg",alt:s.name,className:"absolute inset-0 h-full w-full object-cover",onError:()=>r(!0),onLoad:()=>i(!1)})}),e.jsx(M,{className:"flex flex-col justify-between w-full p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsx("h3",{className:"text-lg font-semibold line-clamp-1 flex-1",children:s.name}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx(h,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:y,children:e.jsx(T,{className:S("h-5 w-5",p(s.id.toString())&&"fill-current text-red-500")})}),e.jsx(h,{size:"icon",variant:"ghost",className:"h-8 w-8",onClick:n,children:e.jsx(L,{className:"h-5 w-5"})})]})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),e.jsx("p",{className:"text-lg font-semibold",children:O(s.price)})]})})]})})}function pe({objects:s}){const{displayedItems:t,loading:i,hasMore:a,loaderRef:r}=Q({items:s,itemsPerPage:3});return e.jsx("div",{className:"relative flex flex-col h-[calc(100dvh-14rem)] -mx-6",children:e.jsxs("div",{className:"flex-1 flex flex-col overflow-y-auto [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden",children:[e.jsx(E,{mode:"popLayout",children:t.map((c,m)=>e.jsx(w.div,{className:"flex-1 min-h-[28%] px-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3,delay:m%4*.1},children:e.jsx(ue,{object:c})},c.id))}),a&&e.jsx("div",{ref:r,className:"h-20 flex items-center justify-center px-6",children:e.jsx(w.div,{animate:i?{rotate:360,scale:[1,1.2,1]}:{y:[0,10,0]},transition:{duration:i?1:1.5,repeat:Number.POSITIVE_INFINITY,ease:"easeInOut"},children:e.jsx(Z,{className:S("h-6 w-6",i?"text-primary animate-spin":"text-muted-foreground")})})})]})})}const C=8,fe=4,ge=Array.from({length:C},(s,t)=>`skeleton-${t}`),xe=5;function Ee(){const{objects:s,isLoading:t}=U(),{filteredObjects:i}=ce(s),a=F(n=>n.displayMode),[r,c]=u.useState(1),[m,v]=u.useState(0),[p,N]=u.useState(fe);if(t)return e.jsx("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:ge.map(n=>e.jsx("div",{className:"h-[300px] animate-pulse rounded-lg bg-muted"},n))});if(i.length===0)return e.jsx("div",{className:"flex h-40 items-center justify-center rounded-lg border bg-card",children:e.jsx("p",{className:"text-center text-muted-foreground",children:"Aucun objet ne correspond à vos critères de recherche."})});switch(a){case"grid":{const n=Math.ceil(i.length/C),y=(r-1)*C,j=y+C,f=i.slice(y,j);let o=[];return n<=xe?o=Array.from({length:n},(l,d)=>d+1):r<=3?o=[1,2,3,4,"ellipsis",n]:r>=n-2?o=[1,"ellipsis",n-3,n-2,n-1,n]:o=[1,"ellipsis",r-1,r,r+1,"ellipsis",n],e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{objects:f}),n>1&&e.jsx(K,{children:e.jsxs(Y,{children:[e.jsx(I,{children:e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>c(l=>Math.max(1,l-1)),disabled:r===1,children:e.jsx(B,{className:"h-4 w-4"})})}),o.map(l=>e.jsx(I,{children:l==="ellipsis"?e.jsx(X,{}):e.jsx(J,{onClick:()=>c(l),isActive:r===l,children:l})},typeof l=="number"?l:`ellipsis-${l}`)),e.jsx(I,{children:e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>c(l=>Math.min(n,l+1)),disabled:r===n,children:e.jsx(z,{className:"h-4 w-4"})})})]})})]})}case"carousel":return e.jsx(he,{objects:[i[m]],onPrevious:()=>v(n=>n===0?i.length-1:n-1),onNext:()=>v(n=>n===i.length-1?0:n+1)});case"infinite":return e.jsx(pe,{objects:i.slice(0,p)});default:return e.jsx(_,{objects:i})}}export{Ee as ObjectDisplay};
