import{M as G,e as k,r as t,j as e,m as M,O as P,B as l,_ as U,L as z,a3 as H,a4 as Q,a5 as Z,a6 as $,a7 as J,a8 as K,a9 as W}from"./index-A8xx-xxW.js";import{T as X,a as Y,b as C,c as g,d as ee,e as m}from"./table-CsEzsDcl.js";import{P as R,a as B,b as V,F as se,A as re,c as ae}from"./popover-Cv9lAuA-.js";import{C as ie,S as ne,a as te,b as oe,c as ce,d as A}from"./select-pnobd5xa.js";import{T as le}from"./textarea-BaE4DFI9.js";import{u as de,s as me,F as xe,a as b,b as w,c as S,d as L,h as I,e as T,z as p}from"./form-NQCUH1ql.js";import{s as F}from"./toast-Cu_8kZFb.js";import{P as ue}from"./plus-B1589Br_.js";import{T as he}from"./trash-2-IQX5vnBl.js";import{E as je}from"./ellipsis-DGixAxWM.js";import"./index-DNZbadIk.js";import"./check-De8WsGE6.js";const ge=p.object({name:p.string().min(3,"Le nom doit contenir au moins 3 caractères").max(100,"Le nom ne peut pas dépasser 100 caractères"),description:p.string().min(10,"La description doit contenir au moins 10 caractères").max(2e3,"La description ne peut pas dépasser 2000 caractères"),icon:p.string().min(1,"L'icône est requise"),image:p.string().min(1,"L'image est requise")});function O({editMode:o=!1}){const x=G(),{id:u}=k(),[c,f]=t.useState(null),[E,v]=t.useState(o),a=de({resolver:me(ge),defaultValues:{name:"",description:"",icon:"",image:""}});t.useEffect(()=>{(async()=>{if(o&&u)try{v(!0);const n=await U(()=>import("./games-categories-DBzAI_sh.js"),[]);console.log("Loading category with ID:",u);const h=Number.parseInt(u,10);console.log("Parsed category ID:",h);const d=n.default.categories.find(j=>j.id===h);console.log("Found category:",d),d?(f(d),a.reset({name:d.name,description:d.description,icon:d.icon,image:d.image})):(console.error("Category not found with ID:",h),F.error("Catégorie non trouvée"),x("/admin/game-categories"))}catch(n){console.error("Erreur lors du chargement de la catégorie:",n),F.error("Erreur lors du chargement de la catégorie")}finally{v(!1)}})()},[o,u,a,x]);const N=async r=>{try{const n={id:(c==null?void 0:c.id)||Math.floor(Date.now()/1e3),name:r.name,description:r.description,icon:r.icon,image:r.image,subcategories:(c==null?void 0:c.subcategories)||[]};console.log("Données de la catégorie à envoyer:",n),F.success(o?"Catégorie mise à jour avec succès":"Catégorie créée avec succès"),x("/admin/game-categories")}catch(n){console.error("Erreur lors de la soumission:",n),F.error("Une erreur est survenue")}};return E?e.jsx("div",{className:"flex h-full items-center justify-center p-8",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})}):e.jsxs(M.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:o?"Modifier la catégorie":"Ajouter une catégorie"}),e.jsx("p",{className:"text-muted-foreground",children:o?"Modifiez les informations de la catégorie":"Ajoutez une nouvelle catégorie"})]}),e.jsx(xe,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(N),className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{control:a.control,name:"name",render:({field:r})=>e.jsxs(w,{children:[e.jsx(S,{children:"Nom"}),e.jsx(L,{children:e.jsx(P,{placeholder:"Entrez le nom de la catégorie",...r})}),e.jsx(I,{children:"Le nom de la catégorie tel qu'il apparaîtra dans le catalogue."}),e.jsx(T,{})]})}),e.jsx(b,{control:a.control,name:"description",render:({field:r})=>e.jsxs(w,{children:[e.jsx(S,{children:"Description"}),e.jsx(L,{children:e.jsx(le,{placeholder:"Entrez la description de la catégorie",className:"min-h-[100px]",...r})}),e.jsx(I,{children:"Une description détaillée de la catégorie."}),e.jsx(T,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(b,{control:a.control,name:"icon",render:({field:r})=>e.jsxs(w,{children:[e.jsx(S,{children:"Icône"}),e.jsx(L,{children:e.jsx(P,{placeholder:"Nom de l'icône Lucide",...r})}),e.jsx(I,{children:"Le nom de l'icône Lucide à utiliser (ex: Sword, Target, etc.)."}),e.jsx(T,{})]})}),e.jsx(b,{control:a.control,name:"image",render:({field:r})=>e.jsxs(w,{children:[e.jsx(S,{children:"Image"}),e.jsx(L,{children:e.jsx(P,{placeholder:"URL de l'image",...r})}),e.jsx(I,{children:"L'URL de l'image d'illustration de la catégorie."}),e.jsx(T,{})]})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>x("/admin/game-categories"),children:"Annuler"}),e.jsx(l,{type:"submit",disabled:a.formState.isSubmitting,children:a.formState.isSubmitting?o?"Mise à jour...":"Création...":o?"Mettre à jour":"Créer"})]})]})})]})}function Ee({isNew:o,isEdit:x}){const{id:u}=k(),[c,f]=t.useState(""),[E,v]=t.useState([]),[a,N]=t.useState(!0),[r,n]=t.useState(!1),[h,d]=t.useState(""),[j,_]=t.useState({sortBy:""}),[q,D]=t.useState(!1);t.useEffect(()=>{(async()=>{try{N(!0);const i=await U(()=>import("./games-categories-DBzAI_sh.js"),[]);v(i.default.categories||[])}catch(i){console.error("Erreur lors du chargement des catégories:",i)}finally{N(!1)}})()},[]);const y=[...E.filter(s=>s.name.toLowerCase().includes(c.toLowerCase())||s.description.toLowerCase().includes(c.toLowerCase()))].sort((s,i)=>{switch(j.sortBy){case"name-asc":return s.name.localeCompare(i.name);case"name-desc":return i.name.localeCompare(s.name);default:return 0}});return o?e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Créer une nouvelle catégorie de jeux"}),e.jsx(O,{})]}):x&&u?e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Modifier la catégorie de jeux"}),e.jsx(O,{editMode:!0})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Catégories de jeux"}),e.jsxs(z,{to:"/admin/game-categories/new",className:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Ajouter une catégorie"]})]}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[e.jsx("div",{className:"relative flex-1",children:e.jsxs(R,{open:r,onOpenChange:n,children:[e.jsx(B,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"w-full justify-start",onClick:()=>n(!r),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:h||"Rechercher une catégorie..."}),e.jsx(ie,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(V,{className:"w-[300px] p-0",align:"start",children:e.jsxs(Q,{children:[e.jsx(Z,{placeholder:"Rechercher une catégorie...",value:c,onValueChange:f}),e.jsxs($,{children:[e.jsx(J,{children:"Aucune catégorie trouvée"}),e.jsx(K,{heading:"Catégories",children:y.slice(0,10).map(s=>e.jsx(W,{value:s.name,onSelect:()=>{f(s.name),d(s.name),n(!1)},children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:s.name})})},s.id))})]})]})})]})}),e.jsxs(R,{open:q,onOpenChange:D,children:[e.jsx(B,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"w-full md:w-auto",disabled:!0,children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Filtres",Object.values(j).some(s=>s!=="")&&e.jsx("span",{className:"ml-2 rounded-full bg-primary w-2 h-2"})]})}),e.jsx(V,{className:"w-80",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium leading-none",children:"Trier par"}),e.jsxs(ne,{value:j.sortBy,onValueChange:s=>_(i=>({...i,sortBy:s})),children:[e.jsx(te,{children:e.jsx(oe,{placeholder:"Trier par..."})}),e.jsxs(ce,{children:[e.jsx(A,{value:"",children:"Par défaut"}),e.jsx(A,{value:"name-asc",children:"Nom A-Z"}),e.jsx(A,{value:"name-desc",children:"Nom Z-A"})]})]})]}),e.jsx(l,{variant:"outline",onClick:()=>{_({sortBy:""}),D(!1)},children:"Réinitialiser les filtres"})]})})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(C,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-1",children:["Nom",e.jsx(re,{className:"h-4 w-4"})]})}),e.jsx(g,{children:"Description"}),e.jsx(g,{children:"Icône"}),e.jsx(g,{children:"Sous-catégories"}),e.jsx(g,{className:"text-right",children:"Actions"})]})}),e.jsx(ee,{children:a?e.jsx(C,{children:e.jsx(m,{colSpan:5,className:"text-center py-8",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"})})})}):y.length===0?e.jsx(C,{children:e.jsx(m,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Aucune catégorie trouvée"})}):y.map(s=>{var i;return e.jsxs(C,{children:[e.jsx(m,{children:e.jsx("span",{className:"font-medium",children:s.name})}),e.jsx(m,{children:s.description}),e.jsx(m,{children:s.icon}),e.jsx(m,{children:((i=s.subcategories)==null?void 0:i.length)||0}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(l,{variant:"ghost",size:"icon",asChild:!0,children:e.jsxs(z,{to:`/admin/game-categories/edit/${s.id}`,children:[e.jsx(ae,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Modifier"})]})}),e.jsxs(l,{variant:"ghost",size:"icon",children:[e.jsx(he,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Supprimer"})]}),e.jsxs(l,{variant:"ghost",size:"icon",children:[e.jsx(je,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Plus"})]})]})})]},s.id)})})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Affichage de ",y.length," catégories"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",size:"sm",disabled:!0,children:"Précédent"}),e.jsx(l,{variant:"outline",size:"sm",children:"Suivant"})]})]})]})}export{Ee as default};
